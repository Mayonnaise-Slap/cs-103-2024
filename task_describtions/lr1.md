# Лабораторная работа 1

## Тема - использование API для сбора информации

[API, REST, http, general python]

# Теоретический материал

- протокол HTTP
- что такое REST API
    - GET-POST-PATCH-PUT-DELETE
    - Аутентификация токенами
    - json
- Библиотека Request
- error-handling

# Практическое задание

Я предоставляю API с 4 заданиями и описанными эндпоинтами
Студены должны зарегистрироваться и получить свой API-токен, который они будут
использовать для аутентификации далее
На API будет действовать rate-limiter и случайно могут выдаваться ошибки - симуляция
нагруженности сервера. Студенты должны учитывать это в своем коде. Также от них
ожидается написание собственных юнит-тестов.

Задание 1: выполнить все виды REST запросов
Задание 2: отсортировать 100 массивов с числами.
Задание 3: обыграть бота в крестики-нолики 50 раз.
Задание 4: интеграция с внешним API. Система запрашивает данные о курсе валюты N в
дату D, ожидает ответ. Повторить 50 раз.

# Реализация системы

Я арендую сервер и разверну бэкэнд на джанго и реверс-прокси для поддержки https и
таймаутов.

# Описание API эндпоинтов

```
/ - описание работы и задач 
/lab1 - потенциально можно будет расширять API
  /task1/ - принимает все виды запросов, необходимо создать каждый
  /task2/
    [GET] - возвращает описание задачи
    [POST]
      {отсортированный массив/NONE} -> {новый массив}
  /task3/
    [GET] - возвращает описание задачи и формат взаимодействия
    [POST] - принимает шаг студента, возвращает состояние доски после своего шага
  /task4/
    [GET] - возвращает описание задачи, нормер испытания, N и D
    [POST] - принимает курс валюты. Ответы: 202 ok, 409 err
  /status - отображает количество решенных задач аккаунта
  /reset
/auth - djoser аутентификация
  /register/
  /token/login/
/test/ - эндпоинт для юниттестов. Возвращает код ошибки
  /401/ - симуляция истекшего токена
  /408/ - симуляция таймаута
/admin/ - можно будет получить список студентов, их прогресс, так далее
 ```

# Баллы

Общее количество - 15 баллов

За каждое успешно выполненное задание студент получает по 2 балла, итого 8
Оставшиеся 7 баллов начисляются за качество кода:

- Организация кода по файлам, нэйминг переменных
- Наличие, качество тестов и error-handling
- Отсутствие code smells
- Обращение с секретами
    - либо os.environ.get('API_KEY')
    - либо config.py файл
- Обращение с GIT
    - правильно настроенный .gitignore
    - отсутствие .DS_Store файлов
    - отсутствие секретов в репозитории и гит истории

Внешние зависимости: эта работа не предполагает использование внешних библиотек

# Текст задачи

Вам предстоит подключиться к моему api по адресу https://oopyat.duckdns.com/ и
выполнить ряд заданий. Система будет запоминать ваш прогресс.

## Задание 0

Вы должны зарегистрироваться в этой системе. Для этого вы должны создать POST запрос
на эндпоинт https://oopyat.duckdns.com/auth/register/. Ваш запрос выглядеть следующим
образом.

```http request
POST https://oopyat.duckdns.com/auth/register/
Content-Type: application/json

{
  "isu": number,
  "full_name": text,
  "group": text,
  "password": (8+ characters)
}
```

Далее вам требуется заполучить токен для работы с API. Токен - это способ приложению
идентифицировать вас как конкретного пользователя. Как мы знаем, REST не следит за тем,
кто, когда и в какой последовательности отправляет запросы. Для того чтобы сервер вас
узнал, необходимо прикладывать ваш аутентификационный токен. Чтобы его получить, создадим
следующий запрос.

```http request
POST https://oopyat.duckdns.com/auth/token/login/
Content-Type: application/json

{
  "isu": number,
  "password": (8+ characters)
}

Responce:  
{
  "Token": your_token_for_authentication
}
```

Все ваши дальнейшие запросы к серверу должны содержать этот токен. Заголовок будет
выглядеть примерно так:

```http request
GET https://oopyat.duckdns.com/lab1/.../
Authorization: Token your_token_for_authentication
...
```

**Важный момент**
1 токен живет всего лишь 50 запросов. Вы должны продумать систему, в которой если ваш
токен устарел - вы автоматически получаете новый и ваша система не падает

## Задание 1

Тут вы должны изучить то, как работают http запросы. REST описывает следующие типы
запросов:

- GET (получение информации)
- POST (создание новой информации)
- PATCH (изменение ресурса)
- PUT (изменение ресурса)
- DELETE (удаление ресурса)

Вы должны выполнить все эти типы запросов на данном эндпоинте, используя свой
аутентификационный токен.

## Задание 2

Ваша следующая задача: отсортировать массивы. При отправке POST запроса вы получите
массив чисел. Вы должны отсортировать его и вернуть серверу, а потом получить новый
массив. Повторить 100 раз.

**Важный момент**
Примерно в 2% случаев сервер будет перегружен и отправит вам ошибку 408: server
timeout. Вам нужно продумать, как повторить ваш запрос так, чтобы не потерять
информацию и чтобы программа не упала

## Задание 3

Ваша следующая задача - обыграть сервер в крестики-нолики 50 раз. Доска 3х3, вы
начинаете первыми. Для вдохновения, посмотрите [комикс](https://xkcd.com/832/) или
[видео](https://www.youtube.com/watch?v=Cxm4qaGTB0M&ab). Ваша
коммуникация с сервером может выглядеть примерно так:

```
YOU: [1, 1]
SERVER: [0, 0] 
YOU: [0, 2]
SERVER: [2, 0]
YOU: [1, 0]
SERVER: [2, 2]
YOU: [2, 1]
SERVER: [1, 2]
YOU: [0, 1]
SERVER: You win. 23/50, start over
```

Доска выглядит так:  
O|X|O  
~~X|X|X~~  
X|O|O

## Задание 4

В этом задании вы должны взаимодействовать не только с моим API, а также с [API
центрального банка](https://www.cbr.ru/development/SXML/). Они возвращают информацию в
формате XML. Вам нужно разобраться, как получить информацию из XML и отправить ее на
сервер.  
Пример данных в формате XML:

```xml
<ValCurs Date="02.03.2002" name="Foreign Currency Market">
    <Valute ID="R01035">
        <NumCode>826</NumCode>
        <CharCode>GBP</CharCode>
        <Nominal>1</Nominal>
        <Name>Фунт стерлингов Соединенного королевства</Name>
        <Value>43,8254</Value>
        <VunitRate>43,8254</VunitRate>
    </Valute>
</ValCurs>
```

В этой задаче вы должны сделать GET запрос на мой сервер. Он будет содержать следующую
информацию:

```json
{
  "date": "дата, за какой день нужны котировки" ,
  "currency": "3-буквенный код валюты" ,
  "count": "3-буквенный код валюты"
}
```

Вы должны узнать курс данной валюты на заданную дату и отправить мне, сколько эта
покупка будет стоить в рублях. 